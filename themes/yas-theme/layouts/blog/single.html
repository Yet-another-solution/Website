{{ define "main" }}
<article class="blog-post">
  <div class="container">
    <nav class="blog-nav-back">
    <a href="/blog/" class="back-to-blog">
      <span class="back-icon">‚Üê</span>
      <span class="back-text">Back to Blog</span>
    </a>
  </nav>

  <header class="post-header">
    <div class="post-meta-enhanced">
      <h1>{{ .Title }}</h1>
      <div class="meta-secondary">
          <div class="d-flex justify-content-between">
              <div>
                  <span class="meta-label">Published</span>
                  <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                      {{ .Date.Format "January 2, 2006" }}
                  </time>

                  {{ if .Params.author }}
                      <div class="meta-content">
                          <span class="meta-label">Author</span>
                          <span>by {{ .Params.author }}</span>
                      </div>
                  {{ end }}
              </div>
              {{ if .ReadingTime }}
                  <div class="meta-content">
                      <span class="meta-label">Reading Time</span>
                      <span class="reading-time">{{ .ReadingTime }} min read</span>
                  </div>
              {{ end }}
          </div>
      </div>
    </div>

    {{ if .Params.series }}
      <div class="post-series-info">
        {{ range .Params.series }}
          {{ $seriesPages := where $.Site.RegularPages "Params.series" "intersect" (slice .) }}
          <div class="series-banner">
            <span class="series-icon">üìö</span>
            <span class="series-text">
              Part {{ $.Params.seriesOrder | default 1 }} of
              <a href="{{ "/series/" | relLangURL }}{{ . | urlize }}">{{ . }}</a> series
              ({{ len $seriesPages }} posts)
            </span>
          </div>
        {{ end }}
      </div>
    {{ end }}

    {{ if .Params.images }}
      <div class="featured-image">
        <img src="{{ index .Params.images 0 }}" alt="{{ .Title }}" loading="lazy">
      </div>
    {{ end }}
  </header>

  {{ if and .Params.toc .TableOfContents }}
  <div class="post-content-wrapper">
    <div class="post-content">
      {{ .Content }}
    </div>
    <div class="table-of-contents">
      <h3>Table of Contents</h3>
      {{ .TableOfContents }}
    </div>
  </div>
  {{ else }}
  <div class="post-content">
    {{ .Content }}
  </div>
  {{ end }}

  <footer class="post-footer">
    {{ if or .Params.tags .Params.series }}
      <div class="post-taxonomies">
        {{ if .Params.tags }}
          <div class="post-tags">
            <h4>Tags:</h4>
            {{ range .Params.tags }}
              <a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}" class="tag">{{ . }}</a>
            {{ end }}
          </div>
        {{ end }}

        {{ if .Params.series }}
          <div class="post-series">
            <h4>Series:</h4>
            {{ range .Params.series }}
              <a href="{{ "/series/" | relLangURL }}{{ . | urlize }}" class="series">{{ . }}</a>
            {{ end }}
          </div>
        {{ end }}
      </div>
    {{ end }}

    <!-- Series Navigation -->
    {{ if .Params.series }}
      {{ range .Params.series }}
        {{ $seriesPages := where $.Site.RegularPages "Params.series" "intersect" (slice .) }}
        {{ $seriesPages := $seriesPages.ByParam "seriesOrder" }}
        {{ $currentIndex := 0 }}
        {{ range $index, $page := $seriesPages }}
          {{ if eq $page.Permalink $.Permalink }}
            {{ $currentIndex = $index }}
          {{ end }}
        {{ end }}

        <nav class="series-navigation">
          <h4>{{ . }} Series Navigation</h4>
          <div class="series-nav-links">
            {{ if gt $currentIndex 0 }}
              {{ $prevPost := index $seriesPages (sub $currentIndex 1) }}
              <a href="{{ $prevPost.Permalink }}" class="series-prev">
                ‚Üê {{ $prevPost.Title }}
              </a>
            {{ end }}

            {{ if lt $currentIndex (sub (len $seriesPages) 1) }}
              {{ $nextPost := index $seriesPages (add $currentIndex 1) }}
              <a href="{{ $nextPost.Permalink }}" class="series-next">
                {{ $nextPost.Title }} ‚Üí
              </a>
            {{ end }}
          </div>

          <div class="series-progress">
            <span>Progress: {{ add $currentIndex 1 }}/{{ len $seriesPages }}</span>
          </div>
        </nav>
      {{ end }}
    {{ end }}

    <!-- Related Posts -->
    {{ if .Site.Params.showRelatedPosts }}
      {{ $related := .Site.RegularPages.Related . | first (.Site.Params.relatedPostsCount | default 3) }}
      {{ if $related }}
        <section class="related-posts">
          <h3>Related Posts</h3>
          <div class="related-posts-grid">
            {{ range $related }}
              <article class="related-post">
                <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
                <time>{{ .Date.Format "January 2, 2006" }}</time>
                {{ if .Description }}
                  <p>{{ .Description }}</p>
                {{ end }}
              </article>
            {{ end }}
          </div>
        </section>
      {{ end }}
    {{ end }}
  </footer>
  </div>
</article>
{{ end }}

{{ define "head" }}
  <link rel="stylesheet" type="text/css" href="{{ `css/blog.css` | relURL }}">

  <!-- Primary Meta Tags -->
  <meta name="title" content="{{ .Title }} | {{ .Site.Title }}">
  <meta name="description" content="{{ .Description | default .Summary | truncate 160 }}">
  {{ if .Params.keywords }}
    <meta name="keywords" content="{{ delimit .Params.keywords ", " }}">
  {{ end }}
  <meta name="author" content="{{ .Params.author | default .Site.Params.author }}">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="{{ .Permalink }}">
  <meta property="og:title" content="{{ .Title }}">
  <meta property="og:description" content="{{ .Description | default .Summary | truncate 160 }}">
  {{ if .Params.images }}
    <meta property="og:image" content="{{ .Site.BaseURL }}{{ index .Params.images 0 }}">
  {{ end }}
  <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
  {{ if .Lastmod.After .Date }}
    <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
  {{ end }}
  {{ if .Params.tags }}
    {{ range .Params.tags }}
      <meta property="article:tag" content="{{ . }}">
    {{ end }}
  {{ end }}

  <!-- Twitter -->
  <meta property="twitter:card" content="{{ .Site.Params.twitterCard | default "summary" }}">
  <meta property="twitter:url" content="{{ .Permalink }}">
  <meta property="twitter:title" content="{{ .Title }}">
  <meta property="twitter:description" content="{{ .Description | default .Summary | truncate 160 }}">
  {{ if .Params.images }}
    <meta property="twitter:image" content="{{ .Site.BaseURL }}{{ index .Params.images 0 }}">
  {{ end }}
  {{ if .Site.Params.twitterSite }}
    <meta property="twitter:site" content="{{ .Site.Params.twitterSite }}">
  {{ end }}

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ .Permalink }}">
{{ end }}